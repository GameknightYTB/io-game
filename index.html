<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jeu d'échelle.io</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEFA; }
        canvas { background: #add8e6; display: block; margin: 0 auto; }
    </style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>
<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let players = {};
let fallingObjects = [];

document.addEventListener('keydown', (e) => {
    let vx = 0, vy = 0;
    if (e.key === 'ArrowLeft') vx = -5;
    if (e.key === 'ArrowRight') vx = 5;
    if (e.key === 'ArrowUp') vy = -5;
    if (e.key === 'ArrowDown') vy = 5;
    socket.emit('move', { vx, vy });
});

document.addEventListener('keyup', () => {
    socket.emit('move', { vx: 0, vy: 0 });
});

socket.on('state', (data) => {
    players = data.players;
    fallingObjects = data.fallingObjects;
});

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Dessiner l'échelle
    for (let i = 0; i < 600; i += 40) {
        ctx.fillStyle = 'brown';
        ctx.fillRect(390, i, 20, 5);
    }

    // Dessiner les objets qui tombent
    for (const obj of fallingObjects) {
        ctx.fillStyle = 'red';
        ctx.beginPath();
        ctx.arc(obj.x, obj.y, 10, 0, Math.PI * 2);
        ctx.fill();
    }

    // Dessiner les joueurs
    for (const id in players) {
        const p = players[id];
        ctx.fillStyle = id === socket.id ? 'blue' : 'green';
        ctx.fillRect(p.x - 10, p.y - 10, 20, 20);
    }

    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
